{% extends 'base.html' %}
{% block title %}Cars{% endblock title %}
{% load static %}

{% block body %}
<main role="main">
  <!-- Hero Section with Gradient Background -->
  <section class="hero-section text-center text-white py-5" 
           style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);">
    <div class="container py-4">
      {% include 'messages.html' %}
      <h1 class="display-4 font-weight-bold mb-3">
        Welcome, {{request.user.username}}!
      </h1>
      <p class="lead mb-4">
        Discover Your Perfect Drive - Premium Cars at Exceptional Rates
      </p>

      <!-- Enhanced Search Bar -->
      <div class="search-container mx-auto" style="max-width: 600px;">
        <form method="GET" action="" class="search-form">
          <div class="input-group">
            <input type="text" name="search" class="form-control form-control-lg"
                   placeholder="Search by brand, model, or features..."
                   value="{{ request.GET.search|default:'' }}"
                   style="border-radius: 30px 0 0 30px;">
            <div class="input-group-append">
              <button type="submit" class="btn btn-primary px-4"
                      style="border-radius: 0 30px 30px 0;">
                <i class="fas fa-search"></i> Search
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Filter Section with Cards -->
  <section class="filter-section py-4" style="background-color: #f8f9fa;">
    <div class="container">
      <form method="GET" action="" class="row justify-content-center">
        <div class="col-md-2 col-sm-6 mb-3">
          <div class="card h-100 shadow-sm">
            <div class="card-body p-2">
              <select class="form-control border-0" name="sort" id="sort">
                <option value="">Sort By</option>
                <option value="price">Price: Low to High</option>
                <option value="-price">Price: High to Low</option>
              </select>
            </div>
          </div>
        </div>

        <div class="col-md-2 col-sm-6 mb-3">
          <div class="card h-100 shadow-sm">
            <div class="card-body p-2">
              <select class="form-control border-0" name="brand" id="brand">
                <option value="">Brand</option>
                {% for brand in brands %}
                <option value="{{ brand.id }}" {% if brand.id|stringformat:"s" == request.GET.brand %}selected{% endif %}>
                  {{ brand.name }}
                </option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <div class="col-md-2 col-sm-6 mb-3">
          <div class="card h-100 shadow-sm">
            <div class="card-body p-2">
              <select class="form-control border-0" name="model" id="model">
                <option value="">Model</option>
                {% for model in models %}
                <option value="{{ model.id }}" {% if model.id|stringformat:"s" == request.GET.model %}selected{% endif %}>
                  {{ model.model_name }}
                </option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <div class="col-md-2 col-sm-6 mb-3">
          <div class="card h-100 shadow-sm">
            <div class="card-body p-2">
              <select class="form-control border-0" name="fuel_type" id="fuel_type">
                <option value="">Fuel Type</option>
                {% for fuel in fuels %}
                <option value="{{ fuel.id }}" {% if fuel.id|stringformat:"s" == request.GET.fuel_type %}selected{% endif %}>
                  {{ fuel.fuel }}
                </option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <div class="col-md-2 col-sm-6 mb-3">
          <button type="submit" class="btn btn-primary w-100 h-100">
            Apply Filters
          </button>
        </div>
      </form>
    </div>
  </section>

  <!-- Cars Grid Section -->
  <section class="cars-section py-5">
    <div class="container">
      {% if car_count == 0 %}
        <div class="text-center py-5">
          <i class="fas fa-car-slash fa-3x mb-3 text-muted"></i>
          <h4 class="text-muted">No cars available matching your criteria.</h4>
        </div>
      {% else %}
        <div class="row">
          {% for i in cars %}
            <div class="col-lg-4 col-md-6 mb-4">
              <div class="card car-card h-100 shadow-sm hover-shadow transition-all">
                <div class="position-relative">
                  <img src="/media/{{ i.image }}" 
                       class="card-img-top" 
                       alt="{{ i.car_name }}"
                       style="height: 200px; object-fit: cover;">
                  {% if not i.available %}
                    <div class="unavailable-badge position-absolute top-0 end-0 m-2">
                      <span class="badge bg-danger">Unavailable</span>
                    </div>
                  {% endif %}
                </div>
                <div class="card-body">
                  <h5 class="card-title font-weight-bold mb-2">{{ i.car_name }}</h5>
                  <p class="card-text text-muted mb-3">{{ i.car_desc }}</p>
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="price-tag">
                      <span class="h5 text-primary mb-0">â‚¹{{ i.price }}</span>
                      <small class="text-muted">/day</small>
                    </div>
                    <div class="car-features">
                      <span class="badge bg-light text-dark me-1">
                        <i class="fas fa-gas-pump"></i> {{ i.fuel_type }}
                      </span>
                    </div>
                  </div>
                  <div class="d-grid gap-2">
                    <a href="{% url 'car_detail' i.id %}" 
                       class="btn btn-primary {% if not i.available %}disabled{% endif %}">
                      {% if i.available %}
                        <i class="fas fa-key"></i> Rent Now
                      {% else %}
                        <i class="fas fa-ban"></i> Unavailable
                      {% endif %}
                    </a>
                    {% if i.is_available_for_lease %}
                      <a href="{% url 'car_detail' i.id %}?type=lease" 
                         class="btn btn-outline-primary {% if not i.available %}disabled{% endif %}">
                        <i class="fas fa-clock"></i> Lease
                      </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Enhanced Pagination -->
      {% if cars.paginator.num_pages > 1 %}
        <nav aria-label="Page navigation" class="mt-5">
          <ul class="pagination justify-content-center">
            {% if cars.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ cars.previous_page_number }}" aria-label="Previous">
                  <i class="fas fa-chevron-left"></i>
                </a>
              </li>
            {% endif %}

            {% for num in cars.paginator.page_range %}
              <li class="page-item {% if cars.number == num %}active{% endif %}">
                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
              </li>
            {% endfor %}

            {% if cars.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ cars.next_page_number }}" aria-label="Next">
                  <i class="fas fa-chevron-right"></i>
                </a>
              </li>
            {% endif %}
          </ul>
        </nav>
      {% endif %}
    </div>
  </section>
</main>

<!-- Add this in your head section or at the end of your body -->
<style>
  .hero-section {
    position: relative;
    overflow: hidden;
  }
  
  .car-card {
    transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
  }
  
  .car-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
  }
  
  .search-form .form-control {
    border: none;
    box-shadow: 0 2px 15px rgba(0,0,0,0.1);
  }
  
  .search-form .form-control:focus {
    box-shadow: 0 2px 15px rgba(0,0,0,0.2);
  }
  
  .filter-section .card {
    transition: all 0.3s ease;
  }
  
  .filter-section .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1) !important;
  }
  
  .price-tag {
    background: rgba(0,123,255,0.1);
    padding: 5px 10px;
    border-radius: 5px;
  }
  
  .badge {
    padding: 8px 12px;
  }
  
  .pagination .page-link {
    border-radius: 50%;
    margin: 0 5px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .pagination .page-item.active .page-link {
    background-color: #1e3c72;
    border-color: #1e3c72;
  }
</style>

{% endblock body %}
